{%- comment -%}
  This section is a slideshow of images.
{%- endcomment -%}

{% liquid
  assign first_slide = section.blocks.first
  assign first_slide_settings = first_slide.settings

  assign first_slide_image = first_slide_settings.image
  assign first_slide_mobile_image = first_slide_settings.mobile_image

  assign first_slide_video = first_slide_settings.video
  assign first_slide_video_mobile = first_slide_settings.video_mobile

  if first_slide_image != blank
    assign slideshow_desktop_aspect_ratio = first_slide_image.aspect_ratio

    if first_slide_mobile_image != blank
      assign slideshow_mobile_aspect_ratio = first_slide_mobile_image.aspect_ratio
    else
      assign slideshow_mobile_aspect_ratio = slideshow_desktop_aspect_ratio
    endif
  else
    assign slideshow_desktop_aspect_ratio = first_slide_video.aspect_ratio

    if first_slide_video_mobile != blank
      assign slideshow_mobile_aspect_ratio = first_slide_video_mobile.aspect_ratio
    else
      assign slideshow_mobile_aspect_ratio = slideshow_desktop_aspect_ratio
    endif
  else
    assign slideshow_desktop_aspect_ratio = '24/9'
    assign slideshow_mobile_aspect_ratio = '3/4'
  endif
%}

{% liquid
  assign full_width = section.settings.full_width

  if full_width == true
    assign desktop_image_sizes = '100vw'
    assign mobile_image_sizes = '(min-width: 75rem) 75rem, 100vw'
  else
    assign desktop_image_sizes = '(min-width: 130rem) 130rem, 100vw'
    assign mobile_image_sizes = '(min-width: 75rem) 75rem, 100vw'
  endif
%}

<style>
  #shopify-section-{{ section.id }} {
    --enable-transparent-header: {% if section.settings.allow_transparent_header %}1{% else %}0{% endif %};
    margin-top: calc((var(--enable-transparent-header, 1) * -1) * var(--header-height, 0px));
  }

  #shopify-section-{{ section.id }} .hero-slideshow--container {
    --slideshow-aspect-ratio: {{ slideshow_desktop_aspect_ratio }};
  }

  @media (max-width: 46.875rem) {
    #shopify-section-{{ section.id }} .hero-slideshow--container {
      --slideshow-aspect-ratio: {{ slideshow_mobile_aspect_ratio }};
    }
  }


  {%- for block in section.blocks -%}
    {%- liquid
      assign desktop_text_position = block.settings.desktop_text_position
      assign desktop_content_align = desktop_text_position | split: ' ' | first
      assign desktop_text_align = desktop_text_position | split: ' ' | last
    %}

    #hero-slideshow--slide-{{ block.id }} .hero-slideshow--slide-content {
      justify-content: {{ desktop_content_align }};
      text-align: {{ desktop_text_align }};
    }

    #hero-slideshow--slide-{{ block.id }} .hero-slideshow--slide-content--button {
      --btn-text-color: {{ block.settings.text_color.rgba }};
      --btn-border-color: {{ block.settings.text_color.rgba }};
    }

    @media (max-width: 46.875rem) {
      #hero-slideshow--slide-{{ block.id }} .hero-slideshow--slide-content {
        display: flex;
        flex-direction: column;
        position: relative;
        height: 100%;
        padding-top: calc(3rem + (var(--enable-transparent-header, 1) * 1) * var(--header-height, 0px));
        padding-bottom: 2.5rem;
        justify-content: space-between;
        text-align: center;
      }
    }
  {%- endfor -%}
</style>

<hero-slideshow
  class="hero-slideshow--container{% unless section.settings.full_width %} container-default{% endunless %}"
  section-id="{{ section.id }}"
  {% if section.settings.autoplay %}
    cycleSpeed="{{ section.settings.cycle_speed }}"
    autoplay
  {% endif %}
>
  <div class="hero-slideshow--slides">
    {% for block in section.blocks %}
      <hero-slide
        id="hero-slideshow--slide-{{ block.id }}"
        class="hero-slideshow--slide{% if block.settings.button_text == blank and block.settings.button_link != blank %} hero-slideshow--slide-clickable{% endif %}"
        blockId="{{ block.id }}"
        slideIndex="{{ forloop.index0 }}"
        style="
          --color-foreground: {{ block.settings.text_color.rgba }};
          --color-background: {{ block.settings.background_color.rgba }};
        "
        {{ block.shopify_attributes }}
      >
        {% if block.settings.button_text == blank and block.settings.button_link != blank %}
          <a
            href="{{ block.settings.button_link }}"
            class="hero-slideshow--slide-link"
            aria-label="{{ block.settings.heading | default: 'Slide link' }}"
          >
        {% endif %}

        {% if block.type == 'video_slide' %}
          <div class="hero-slideshow--slide-video-wrapper">
            {% if block.settings.video != blank %}
              {{
                block.settings.video
                | video_tag:
                  playsinline: true,
                  muted: true,
                  loop: true,
                  controls: false,
                  preload: 'metadata',
                  autoplay: true,
                  loading: 'lazy',
                  class: 'hero-slideshow--slide-video'
              }}

              {% if block.settings.video_mobile != blank %}
                {{
                  block.settings.video_mobile
                  | video_tag:
                    playsinline: true,
                    muted: true,
                    loop: true,
                    controls: false,
                    preload: 'metadata',
                    autoplay: true,
                    loading: 'lazy',
                    class: 'hero-slideshow--slide-video'
                -}}
              {% endif %}
            {% endif %}
          </div>
        {% else %}
          <div class="hero-slideshow--slide-image-wrapper">
            {% if block.settings.image != blank %}
              <img
                class="hero-slideshow--slide-image"
                alt="{{ block.settings.image.alt | escape }}"
                height="{{ block.settings.image.height }}"
                sizes="{{ desktop_image_sizes }}"
                srcset="
                  {% if block.settings.image.width >= 350 %}{{ block.settings.image | image_url: width: 350 }} 350w,{% endif %}
                  {% if block.settings.image.width >= 750 %}{{ block.settings.image | image_url: width: 750 }} 750w,{% endif %}
                  {% if block.settings.image.width >= 1100 %}{{ block.settings.image | image_url: width: 1100 }} 1100w,{% endif %}
                  {% if block.settings.image.width >= 1500 %}{{ block.settings.image | image_url: width: 1500 }} 1500w,{% endif %}
                  {% if block.settings.image.width >= 2200 %}{{ block.settings.image | image_url: width: 2200 }} 2200w,{% endif %}
                  {% if block.settings.image.width >= 3000 %}{{ block.settings.image | image_url: width: 3000 }} 3000w,{% endif %}
                  {{ block.settings.image | image_url }} {{ block.settings.image.width }}w
                "
                width="{{ block.settings.image.width }}"
                fetchpriority="high"
                loading="eager"
              >

              {% if block.settings.mobile_image != blank %}
                <img
                  class="hero-slideshow--slide-image"
                  alt="{{ block.settings.mobile_image.alt | escape }}"
                  height="{{ block.settings.mobile_image.height }}"
                  sizes="{{ mobile_image_sizes }}"
                  srcset="
                    {% if block.settings.mobile_image.width >= 350 %}{{ block.settings.mobile_image | image_url: width: 350 }} 350w,{% endif %}
                    {% if block.settings.mobile_image.width >= 750 %}{{ block.settings.mobile_image | image_url: width: 750 }} 750w,{% endif %}
                    {% if block.settings.mobile_image.width >= 1100 %}{{ block.settings.mobile_image | image_url: width: 1100 }} 1100w,{% endif %}
                    {% if block.settings.mobile_image.width >= 1500 %}{{ block.settings.mobile_image | image_url: width: 1500 }} 1500w,{% endif %}
                    {% if block.settings.mobile_image.width >= 2200 %}{{ block.settings.mobile_image | image_url: width: 2200 }} 2200w,{% endif %}
                    {% if block.settings.mobile_image.width >= 3000 %}{{ block.settings.mobile_image | image_url: width: 3000 }} 3000w,{% endif %}
                    {{ block.settings.mobile_image | image_url }} {{ block.settings.mobile_image.width }}w
                  "
                  width="{{ block.settings.mobile_image.width }}"
                  fetchpriority="high"
                  loading="eager"
                >
              {% endif %}
            {% endif %}
          </div>
        {% endif %}

        {% if block.settings.show_overlay %}
          <div class="hero-slideshow--text-overlay" aria-hidden="true"></div>
        {% endif %}

        <div class="hero-slideshow--slide-container container-default-full">
          <div class="hero-slideshow--slide-content">
            <div class="hero-slideshow--slide-content--inner">
              {% if block.settings.heading != blank %}
                <h2 class="hero-slideshow--slide-content--heading">{{ block.settings.heading }}</h2>
              {% endif %}

              {% if block.settings.subheading != blank %}
                <div class="hero-slideshow--slide-content--subheading">
                  {{- block.settings.subheading -}}
                </div>
              {% endif %}

              {% if block.settings.button_text != blank %}
                <a class="hero-slideshow--slide-content--button btn" href="{{ block.settings.button_link }}">
                  {{- block.settings.button_text -}}
                </a>
              {% endif %}
            </div>
          </div>
        </div>

        {% if block.settings.button_text == blank and block.settings.button_link != blank %}
          </a>
        {% endif %}
      </hero-slide>
    {% endfor %}
  </div>

  <div class="hero-slideshow--controls">
    {% if section.settings.show_arrows %}
      <button class="hero-slideshow--arrow prev-button" type="button">
        <span class="sr-only">Previous slide</span>

        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M16.5 3L7.5 12L16.5 21" stroke="currentColor" stroke-linecap="square" stroke-linejoin="round"/>
        </svg>
      </button>

      <button class="hero-slideshow--arrow next-button" type="button">
        <span class="sr-only">Next slide</span>

        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M7.5 21L16.5 12L7.5 3" stroke="currentColor" stroke-linecap="square" stroke-linejoin="round"/>
        </svg>
      </button>
    {% endif %}
  </div>

  {% if section.blocks.size > 1 and section.settings.show_dots %}
    <hero-slideshow-dots class="hero-slideshow--dots" activeIndex="0">
      {% for block in section.blocks %}
        <button
          class="hero-slideshow--dot{% if forloop.first %} active{% endif %}"
          type="button"
          aria-label="Slide {{ forloop.index }}"
          slide-index="{{ forloop.index0 }}"
        >
          <span class="sr-only">Slide {{ forloop.index }}</span>
          <span class="hero-slideshow--dot-indicator"></span>
        </button>
      {% endfor %}
    </hero-slideshow-dots>
  {% endif %}
</hero-slideshow>

{% schema %}
{
  "name": "Hero slideshow",
  "tag": "section",
  "class": "hero-slideshow",
  "max_blocks": 5,
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Full width",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "allow_transparent_header",
      "label": "Allow transparent header",
      "info": "This setting only applies when this section is the first one.",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Auto rotate between slides",
      "default": true
    },
    {
      "type": "range",
      "id": "cycle_speed",
      "min": 2,
      "max": 10,
      "step": 1,
      "unit": "sec",
      "label": "Change slides every",
      "default": 6
    },
    {
      "type": "header",
      "content": "Controls"
    },
    {
      "type": "checkbox",
      "id": "show_arrows",
      "label": "Show arrows",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_dots",
      "label": "Show dots",
      "default": true
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "image_picker",
          "id": "mobile_image",
          "label": "Mobile image"
        },
        {
          "type": "header",
          "content": "Content"
        },
        {
          "type": "select",
          "id": "desktop_text_position",
          "label": "Desktop text position",
          "options": [
            {
              "value": "flex-start start",
              "label": "Top left"
            },
            {
              "value": "flex-start center",
              "label": "Top center"
            },
            {
              "value": "flex-start end",
              "label": "Top right"
            },
            {
              "value": "center start",
              "label": "Middle left"
            },
            {
              "value": "center center",
              "label": "Middle center"
            },
            {
              "value": "center end",
              "label": "Middle right"
            },
            {
              "value": "flex-end start",
              "label": "Bottom left"
            },
            {
              "value": "flex-end center",
              "label": "Bottom center"
            },
            {
              "value": "flex-end end",
              "label": "Bottom right"
            }
          ],
          "default": "flex-end end"
        },
        {
          "type": "textarea",
          "id": "heading",
          "label": "Heading",
          "default": "Slide title"
        },
        {
          "type": "text",
          "id": "subheading",
          "label": "Subheading",
          "default": "New Era for Espresso Machine"
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "Button text",
          "default": "Learn more"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "Button link"
        },
        {
          "type": "header",
          "content": "Colors"
        },
        {
          "type": "checkbox",
          "id": "show_overlay",
          "label": "Show overlay",
          "default": false
        },
        {
          "type": "color",
          "id": "text_color",
          "label": "Text color",
          "default": "#ffffff"
        },
        {
          "type": "color",
          "id": "background_color",
          "label": "Background color",
          "default": "#121212"
        }
      ]
    },
    {
      "type": "video_slide",
      "name": "Video slide",
      "settings": [
        {
          "type": "video",
          "id": "video",
          "label": "Video"
        },
        {
          "type": "video",
          "id": "video_mobile",
          "label": "Mobile video"
        },
        {
          "type": "header",
          "content": "Content"
        },
        {
          "type": "select",
          "id": "desktop_text_position",
          "label": "Desktop text position",
          "options": [
            {
              "value": "flex-start start",
              "label": "Top left"
            },
            {
              "value": "flex-start center",
              "label": "Top center"
            },
            {
              "value": "flex-start end",
              "label": "Top right"
            },
            {
              "value": "center start",
              "label": "Middle left"
            },
            {
              "value": "center center",
              "label": "Middle center"
            },
            {
              "value": "center end",
              "label": "Middle right"
            },
            {
              "value": "flex-end start",
              "label": "Bottom left"
            },
            {
              "value": "flex-end center",
              "label": "Bottom center"
            },
            {
              "value": "flex-end end",
              "label": "Bottom right"
            }
          ],
          "default": "flex-end end"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Slide title"
        },
        {
          "type": "text",
          "id": "subheading",
          "label": "Subheading",
          "default": "New Era for Espresso Machine"
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "Button text",
          "default": "Learn more"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "Button link"
        },
        {
          "type": "header",
          "content": "Colors"
        },
        {
          "type": "checkbox",
          "id": "show_overlay",
          "label": "Show overlay",
          "default": false
        },
        {
          "type": "color",
          "id": "text_color",
          "label": "Text color",
          "default": "#ffffff"
        },
        {
          "type": "color",
          "id": "background_color",
          "label": "Background color",
          "default": "#121212"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Hero slideshow",
      "blocks": [
        {
          "type": "slide"
        },
        {
          "type": "slide"
        }
      ]
    }
  ]
}
{% endschema %}
