<div class="product-sticky">
  <div class="product-sticky__content">
    <span class="product-sticky__content-icon" id="product-sticky-icon">
      <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" fill="none">
        <path d="M26.6673 16V29.3333H5.33398V16" stroke="white" stroke-width="2" stroke-linecap="round"/>
        <path d="M29.3327 9.3335H2.66602V16.0002H29.3327V9.3335Z" stroke="white" stroke-width="2" stroke-linecap="round"/>
        <path d="M16 29.3331L16 16.8887" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M15.9993 9.33317H9.99935C9.11529 9.33317 8.26745 8.98198 7.64233 8.35686C7.01721 7.73174 6.66602 6.88389 6.66602 5.99984C6.66602 5.11578 7.01721 4.26794 7.64233 3.64281C8.26745 3.01769 9.11529 2.6665 9.99935 2.6665C14.666 2.6665 15.9993 9.33317 15.9993 9.33317Z" stroke="white" stroke-width="2" stroke-linecap="round"/>
        <path d="M16 9.33317H22C22.8841 9.33317 23.7319 8.98198 24.357 8.35686C24.9821 7.73174 25.3333 6.88389 25.3333 5.99984C25.3333 5.11578 24.9821 4.26794 24.357 3.64281C23.7319 3.01769 22.8841 2.6665 22 2.6665C17.3333 2.6665 16 9.33317 16 9.33317Z" stroke="white" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </span>
    <a class="product-sticky__content-text" href="{{ section.settings.button_url }}">
      {{ section.settings.button_text }}
    </a>
  </div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    var popup = document.getElementById('subscription-popup');
    var productIcon = document.getElementById('product-sticky-icon');
    var subscriptionPopupMini = document.getElementById('subscription-popup-mini');
    var productSticky = document.querySelector('.product-sticky');

    var productText = document.querySelector('.product-sticky__content-text');

    productIcon.addEventListener('click', function () {
      popup.classList.remove('hidden');
    });

    // Mobile detection
    function isMobile() {
      return window.innerWidth <= 768;
    }

    // Show/hide based on scroll position on mobile
    function handleScroll() {
      if (isMobile() && subscriptionPopupMini) {
        subscriptionPopupMini.style.display = 'none';
      }
      if (window.location.pathname == '{{ section.settings.button_url }}') {
        if (window.scrollY > 700) {
          productText.style.display = 'flex';
        } else {
          productText.style.display = 'none';
        }
        productText.href = '#MainProduct-template--24433212588319__main';
        return;
      }

      const heroContainer = document.querySelector('.hero-slideshow--container');
      if (!heroContainer) {
        productText.style.display = 'flex';
        return;
      }

      // 检查hero容器是否已经滚动出视口
      const heroRect = heroContainer.getBoundingClientRect();
      if (heroRect.bottom <= heroContainer.offsetHeight) {
        productText.style.display = 'flex';
      } else {
        productText.style.display = 'none';
      }
    }

    // Initial check
    handleScroll();

    // Listen for scroll and resize events
    window.addEventListener('scroll', handleScroll);
    window.addEventListener('resize', handleScroll);
  });
</script>
{% schema %}
{
  "name": "Product Sticky",
  "settings": [
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "Buy Now"
    },
    {
      "type": "url",
      "id": "button_url",
      "label": "Button URL"
    }
  ],
  "presets": [
    {
      "name": "Product Sticky"
    }
  ]
}
{% endschema %}
